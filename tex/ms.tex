% !TeX root = ./ms.tex
\documentclass[modern]{aastex62}

% Load the corTeX style definitions
\input{cortex}

% Load custom style
\input{style}

% Bibliography
\bibliographystyle{aasjournal}

\usepackage{etoolbox}
\makeatletter % we need to patch \env@cases that has @ in its name
\patchcmd{\env@cases}{\quad}{\qquad\qquad}{}{}
\makeatother

\usepackage{enumitem}

% Begin!
\begin{document}

% Title
\title{%
    \textbf{
        Interpretable Gaussian Processes for Stellar Light Curves
    }
}

% Author list
\author[0000-0002-0296-3826]{Rodrigo Luger}\altaffiliation{Flatiron Fellow}
\email{rluger@flatironinstitute.org}
\affil{Center~for~Computational~Astrophysics, Flatiron~Institute, New~York, NY}
\affil{Virtual~Planetary~Laboratory, University~of~Washington, Seattle, WA}
%

\keywords{methods: analytic}

% \begin{abstract}
%     Abstract here.
%     %
%     \href{https://github.com/rodluger/starry_process}{\color{linkcolor}\faGithub}
% \end{abstract}

\section{Introduction}
\label{sec:intro}
\xxx{Talk about starry, gps, etc.}

\section{Spherical Harmonics}
\label{sec:ylm}
%
\xxx{Introduce the spherical harmonics.}

The real spherical harmonics are indexed by their degree $l \in [0, \infty]$
and order $m \in [-l, l]$. It is convenient to collect the spherical harmonic coefficients of
a given expansion into a vector $\mathbf{y}$ indexed by a single
integer $n$, where
%
\begin{align}
    \label{eq:n}
    n = l^2 + l + m
\end{align}
%
and, conversely,
%
\begin{align}
    \label{eq:lm}
    \begin{split}
        l & = \floor{\sqrt{n}}
        \\
        m & = n - l^2 - l
        \quad.
    \end{split}
\end{align}

\section{Gaussian Process}
\label{sec:gp}
%

% The vector $\pmb{\theta}$ includes physical properties of the star such
% as its inclination $i$ and rotational period $P$ as well as parameters
% describing the shape of the probability density function (PDF) governing
% the distribution of features on the surface.

Let
$\mathbf{f} = \left( f_0 \, f_1 \, \cdots \,  f_K \right)^\top$
denote a vector of $K$ flux measurements at times
$\left( t_0 \,  t_1 \,  \cdots \, t_K \right)^\top$.
Conditioned on certain physical properties of the star, $\pmb{\theta}$,
we wish to compute the mean $\pmb{\mu}(\pmb{\theta})$ and
covariance $\pmb{\Sigma}(\pmb{\theta})$
of $\mathbf{f}$, which together fully specify our GP in flux.
%
As with any random variable, the mean and covariance may be computed from
the expectation value of $\mathbf{f}$ and
$\mathbf{f}\,\mathbf{f}^\top$, respectively:
%
\begin{align}
    \label{eq:mean}
    \pmb{\mu}(\pmb{\theta})
     & = \mathrm{E} \Big[ \mathbf{f} \, \Big| \, \pmb{\theta} \Big]
    \\
    \label{eq:cov}
    \pmb{\Sigma}(\pmb{\theta})
     & = \mathrm{E} \Big[ \mathbf{f} \, \mathbf{f}^\top \, \Big| \, \pmb{\theta} \Big] - \pmb{\mu}(\pmb{\theta}) \pmb{\mu}^\top(\pmb{\theta})
    \quad.
\end{align}
%
In \citet{Luger2019} we showed that $\mathbf{f}$ may be computed from a
linear operation on the vector of spherical harmonic coefficients
describing the surface, $\mathbf{y}$:
%
\begin{align}
    \label{eq:fAy}
    \mathbf{f} = \mathbf{A} \, \mathbf{y}
    \quad,
\end{align}
%
where $\mathbf{A}$ is the \starry design matrix, which is implicitly
a function of $\pmb{\theta}$ (as it depends on the stellar inclination
and rotation period, for example).
%
Given Equation~(\ref{eq:fAy}),
we may write the mean and covariance of our flux GP as
%
\begin{align}
    \pmb{\mu}(\pmb{\theta})
     & = \mathbf{A}(\pmb{\theta}) \, \pmb{\mu}_{\mathbf{y}}(\pmb{\theta})
    \\
    \pmb{\Sigma}(\pmb{\theta})
     & = \mathbf{A}(\pmb{\theta}) \, \pmb{\Sigma}_{\mathbf{y}} \, \mathbf{A}^\top(\pmb{\theta})
    \quad,
\end{align}
%
where
%
\begin{align}
    \label{eq:mean_y}
    \pmb{\mu}_{\mathbf{y}}(\pmb{\theta})
     & = \mathrm{E} \Big[ \mathbf{y} \, \Big| \, \pmb{\theta} \Big]
    \\
    \label{eq:cov_y}
    \pmb{\Sigma}_{\mathbf{y}}(\pmb{\theta})
     & = \mathrm{E} \Big[ \mathbf{y} \, \mathbf{y}^\top \, \Big| \, \pmb{\theta} \Big] - \pmb{\mu}_{\mathbf{y}}(\pmb{\theta}) \pmb{\mu}_{\mathbf{y}}^\top(\pmb{\theta})
\end{align}
%
are the mean and covariance of the GP in the spherical harmonics basis.
The bulk of the math in this paper is devoted to computing
the expectations in the expressions above, which
are given by the integrals
%
\begin{align}
    \label{eq:exp_y}
    \mathrm{E} \Big[ \mathbf{y} \, \Big| \, \pmb{\theta} \Big]
     & =
    \int \mathbf{y}(\mathbf{x} ) \, p(\mathbf{x} \, \big| \, \pmb{\theta})\mathrm{d}\mathbf{x}
    \\
    \label{eq:exp_yy}
    \mathrm{E} \Big[ \mathbf{y} \, \mathbf{y}^\top \, \Big| \, \pmb{\theta} \Big]
     & =
    \int \mathbf{y}(\mathbf{x} ) \mathbf{y}^\top(\mathbf{x} ) \, p(\mathbf{x} \, \big| \, \pmb{\theta})\mathrm{d}\mathbf{x}
    \quad,
\end{align}
%
where $\mathbf{x}$ is a random vector-valued variable corresponding to a particular
distribution of features on the surface  (i.e., the size and location of star spots)
and $p(\mathbf{x} \, \big| \, \pmb{\theta})$ is its probability density
function (PDF).

In the sections that follow we will show that for suitable choices of $\mathbf{y}(\mathbf{x})$
and $p(\mathbf{x} \, \big| \, \pmb{\theta})$, the integrals in the expressions
above have closed form solutions that may be evaluated quickly.
%
As we are specifically interested in modeling the effect of star spots
on stellar light curves, we let
%
\begin{align}
    \mathbf{x} = \left( c \,\, \lambda \,\, \phi \,\, r \right)^\top
\end{align}
%
and
%
\begin{align}
    \label{eq:RRs}
    \mathbf{y}(\mathbf{x}) =
    c
    \,
    \mathbf{R}_{\hat{\mathbf{y}}}(\lambda)
    \,
    \mathbf{R}_{\hat{\mathbf{x}}}(\phi)
    \,
    \mathbf{s}(r)
    \quad,
\end{align}
%
where $c$ is the contrast of a spot,
$\lambda$ is its longitude, $\phi$ is its latitude,
and $r$ is its radius.
The vector function $\mathbf{s}(r)$
returns the spherical harmonic expansion of a negative unit brightness
circular spot at $\lambda = \phi = 0$,
$\mathbf{R}_{\hat{\mathbf{x}}}(\phi)$ is the Wigner matrix that rotates the
expansion about $\hat{\mathbf{x}}$ such that the spot is centered at a
latitude $\phi$, and $\mathbf{R}_{\hat{\mathbf{y}}}(\lambda)$ is the Wigner
matrix that then rotates the
expansion about $\hat{\mathbf{y}}$ such that the spot is centered at a
longitude $\lambda$; these three functions are detailed in the sections below.
%
Equation~(\ref{eq:RRs}) thus provides a way of converting a random variable
$\mathbf{x}$ describing the size, brightness, and position of a spot to the
corresponding representation in terms of spherical harmonics.
%
Note, importantly, that we are not interested in any specific value of
$\mathbf{y}$; rather, we would like to know its expectation value under
the probability distribution governing the different spot properties $\mathbf{x}$,
i.e., $p(\mathbf{x} \, \big| \, \pmb{\theta})$.
%
For simplicity, we assume that $p(\mathbf{x} \, \big| \, \pmb{\theta})$
is separable in each of the four spot properties:
%
\begin{align}
    p(\mathbf{x} \, \big| \, \pmb{\theta})
    =
    p(c \, \big| \, \pmb{\theta}_{c}) \,
    p(\lambda \, \big| \, \pmb{\theta}_{\lambda}) \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi})\,
    p(r \, \big| \, \pmb{\theta}_{r})
    \quad,
\end{align}
%
where
%
\begin{align}
    \pmb{\theta} = \left(
    \pmb{\theta}_{c} \, \,
    \pmb{\theta}_{\lambda} \, \,
    \pmb{\theta}_{\phi} \, \,
    \pmb{\theta}_{r} \right)^\top
    \quad.
\end{align}
%
This allows us to rewrite the expectation integrals (\ref{eq:exp_y})
and (\ref{eq:exp_yy}) as
%
\begin{align}
    \label{eq:exp_y_sep}
    \mathrm{E} \Big[ \mathbf{y} \, \Big| \, \pmb{\theta} \Big]
     & =
    \mathbf{e}_c
    \\[1em]
    \label{eq:exp_yy_sep}
    \mathrm{E} \Big[ \mathbf{y} \, \mathbf{y}^\top \, \Big| \, \pmb{\theta} \Big]
     & =
    \mathbf{E}_c
\end{align}
%
where we define the first moment integrals
%
\begin{align}
    \label{eq:e1}
    \mathbf{e}_r
     & \equiv
    \int
    \mathbf{s}(r) \,
    p(r \, \big| \, \pmb{\theta}_{r}) \,
    \mathrm{d}r
    %
    \\[1em]
    %
    \label{eq:e2}
    \mathbf{e}_\phi
     & \equiv
    \int
    \mathbf{R}_{\hat{\mathbf{x}}}(\phi) \,
    \mathbf{e}_r \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi}) \,
    \mathrm{d}\phi
    %
    \\[1em]
    %
    \label{eq:e3}
    \mathbf{e}_\lambda
     & \equiv
    \int
    \mathbf{R}_{\hat{\mathbf{y}}}(\lambda) \,
    \mathbf{e}_\phi \,
    p(\lambda \, \big| \, \pmb{\theta}_{\lambda}) \,
    \mathrm{d}\lambda
    \\[1em]
    \label{eq:e4}
    \mathbf{e}_c
     & \equiv
    \int
    c \,
    \mathbf{e}_\lambda \,
    p(c \, \big| \, \pmb{\theta}_{c}) \,
    \mathrm{d}c
    %
\end{align}
%
and the second moment integrals
%
\begin{align}
    \label{eq:E1}
    \mathbf{E}_r
     & \equiv
    \int
    \mathbf{s}(r) \, \mathbf{s}^\top(r) \,
    p(r \, \big| \, \pmb{\theta}_{r}) \,
    \mathrm{d}r
    %
    \\[1em]
    %
    \label{eq:E2}
    \mathbf{E}_\phi
     & \equiv
    \int
    \mathbf{R}_{\hat{\mathbf{x}}}(\phi) \,
    \mathbf{E}_r \,
    \mathbf{E}_r^\top \,
    \mathbf{R}_{\hat{\mathbf{x}}}^\top(\phi) \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi})
    \mathrm{d}\phi
    %
    \\[1em]
    %
    \label{eq:E3}
    \mathbf{E}_\lambda
     & \equiv
    \int
    \mathbf{R}_{\hat{\mathbf{y}}}(\lambda) \,
    \mathbf{E}_\phi \,
    \mathbf{E}_\phi^\top \,
    \mathbf{R}_{\hat{\mathbf{y}}}^\top(\lambda) \,
    p(\lambda \, \big| \, \pmb{\theta}_{\lambda})
    \mathrm{d}\phi
    \\[1em]
    %
    \label{eq:E4}
    \mathbf{E}_c
     & \equiv
    \int
    c^2 \,
    \mathbf{E}_\lambda \,
    \mathbf{E}_\lambda^\top \,
    p(c \, \big| \, \pmb{\theta}_c)
    \mathrm{d}c
    %
    \quad.
\end{align}
%
We devote the next four sections to the computation of these eight
integrals.


\section{The Size and Contrast Integrals}
\label{sec:size-contrast}

\section{The Latitude and Longitude Integrals}
\label{sec:lat-lon}
%
Our goal in this section is to compute the integrals...

\subsection{Rotation matrices}
%
The Wigner rotation matrix for real spherical harmonics up to degree $l_{\mathrm{max}}$
may be written as the block-diagonal matrix
%
\begin{align}
    \setstackgap{L}{1.25\baselineskip}
    \fixTABwidth{T}
    \mathbf{R} =
    \parenMatrixstack{
    \quad\quad \, \mathbf{R}^0 \, \quad\quad
     &              &              &        &                               \\
     & \mathbf{R}^1 &              &        &                               \\
     &              & \mathbf{R}^2 &        &                               \\
     &              &              & \ddots &                               \\
     &              &              &        & \mathbf{R}^{l_{\mathrm{max}}}
    }\quad,
\end{align}
%
where
%
\begin{align}
    \mathbf{R}^l = {\mathbf{U}^l}^{-1} \mathbf{D}^l \mathbf{U}^l
\end{align}
%
is the Wigner rotation matrix for a single spherical harmonic degree,
%
\begin{align}
    \label{eq:U}
    \setstackgap{L}{1.25\baselineskip}
    \fixTABwidth{T}
    \mathbf{U}^l =
    \frac{1}{\sqrt{2}}
    \parenMatrixstack{
        \quad\quad\, \ddots \, \quad\quad\quad\quad
           &       &        &       &          &    &   &    & \Ddots \\
           & \imag &        &       &          &    &   & 1  &        \\
           &       & \imag  &       &          &    & 1 &    &        \\
           &       &        & \imag &          & 1  &   &    &        \\
           &       &        &       & \sqrt{2} &    &   &    &        \\
           &       &        & \imag &          & -1 &   &    &        \\
           &       & -\imag &       &          &    & 1 &    &        \\
           & \imag &        &       &          &    &   & -1 &        \\
    \Ddots &       &        &       &          &    &   &    & \ddots
    }
\end{align}
%
describes the transformation from complex to real spherical harmonics,
and $\mathbf{D}$ is the Wigner matrix for complex spherical harmonics,
whose terms are given by the expression
%
\begin{align}
    D_{m,m'}^l(\alpha, \beta, \gamma) = \mathrm{e}^{-\imag m' \alpha}
    d_{m,m'}^l(\beta) \mathrm{e}^{-\imag m \gamma}
\end{align}
%
where $\alpha$, $\beta$, and $\gamma$ are the Euler angles describing
the rotation in the
$\hat{\mathbf{z}}{-}\hat{\mathbf{y}}{-}\hat{\mathbf{z}}$ convention
and $\imag$ is the imaginary unit. The terms of the $d$-matrix
depend on powers of $\sin\left(\nicefrac{\beta}{2}\right)$
and $\cos\left(\nicefrac{\beta}{2}\right)$
\citep[c.f. Equation C15 in][]{Luger2019}, but it is convenient to use
the half-angle formula to express these terms instead as
%
\begin{proof}{test_dlmmp}
    d_{m,m'}^l(\beta) =
    \sum\limits_{i=0}^{2l} c_{m,m',i}^{l}
    \mathrm{sgn}(\sin\beta)^{i}
    (1 - \cos\beta)^{\frac{2l - i}{2}}
    (1 + \cos\beta)^\frac{i}{2}
\end{proof}
%
where
%
\begin{proof}{test_dlmmp}
    c_{m,m',i}^{l} & =
    \resizebox{.75\hsize}{!}{$
            \begin{cases}
                \dfrac{
                \left(-1\right)^{\frac{2l + 3m + m' - i}{2}}
                \sqrt{\left(l - m\right)!
                    \left(l + m\right)!
                    \left(l - m'\right)!
                    \left(l + m'\right)!}
                }{
                2^l
                \left(\frac{i - m - m'}{2}\right)!
                \left(\frac{i + m + m'}{2}\right)!
                \left(\frac{2l - i - m + m'}{2}\right)!
                \left(\frac{2l - i + m - m'}{2}\right)!
                }
                %
                 & m - m' - i \,\, \mathrm{even}
                %
                \\[0.5em]
                0
                %
                 & m - m' - i \,\, \mathrm{odd}
            \end{cases}
        $}
\end{proof}
%

\subsection{Latitude}
%
The latitude integrals (Equations~\ref{eq:e2} and \ref{eq:E2}) involve
rotations about $\hat{\mathbf{x}}$, which
may be accomplished by choosing
Euler angles $\alpha = \nicefrac{\pi}{2}$, $\beta = \phi$, and
$\gamma = -\nicefrac{\pi}{2}$, such that
%
\begin{align}
    \mathbf{R}^l_{\hat{\mathbf{x}}}(\phi)
     & =
    {\mathbf{U}^l}^{-1} \mathbf{D}^l_{\hat{\mathbf{x}}}(\phi) \mathbf{U}^l
\end{align}
%
with
\begin{align}
    \mathbf{D}^l_{\hat{\mathbf{x}}}(\phi)
     & =
    \mathbf{D}^l\left(\frac{\pi}{2}, \phi, -\frac{\pi}{2}\right)
    \quad.
\end{align}
%
From the expressions above, it is clear that all terms in
$\mathbf{R}_{\hat{\mathbf{x}}}(\phi)$ are equal to (weighted) sums of powers
of $(1 \pm \cos\phi)$.
%
Since our goal is to compute integrals of these terms multiplied by
a probability density function, it is convenient to model
$\cos\phi$ as a Beta-distributed variable. As we will see, this
choice will allow us to
analytically compute the first two moments of the distribution of
$\phi$ conditioned on $\pmb{\theta}_\phi$.

%
The Beta distribution in $\cos\phi$ has hyperparameters
%
\begin{align}
    \pmb{\theta}_\phi = \left(
    \alpha \, \, \, \,
    \beta \right)^\top
\end{align}
%
and PDF given by
%
\begin{align}
    \label{eq:cosphi-pdf}
    p \big(\cos\phi \, \big| \, \pmb{\theta}_\phi \big)
     & =
    \dfrac{\Gamma(\alpha + \beta)}{\Gamma(\alpha)\Gamma(\beta)}
    (\cos\phi)^{\alpha - 1}
    (1 - \cos\phi)^{\beta - 1}
    \quad,
\end{align}
%
where $\Gamma$ is the Gamma function. The implied distribution for $\phi$
may be computed by a straightforward change of variable:
%
\begin{proof}{test_beta_transform}
    \label{eq:phi-pdf}
    p \big(\phi \, \big| \, \pmb{\theta}_\phi \big)
    & =
    \dfrac{\Gamma(\alpha + \beta)}{2\Gamma(\alpha)\Gamma(\beta)}
    \big|
    \sin\phi
    \big|
    (\cos\phi)^{\alpha - 1}
    (1 - \cos\phi)^{\beta - 1}
    \quad,
\end{proof}
%
for $\phi \in \left[ -\frac{\pi}{2}, \frac{\pi}{2} \right]$.

\subsubsection{First moment}
%
Since the Wigner matrices are block diagonal, we may evaluate the moments of the
distribution one spherical harmonic degree at a time. To that end, let us
write the first moment integral as
%
\begin{proof}{test_ephi}
    \mathbf{e}_\phi
    & \equiv
    \int
    \mathbf{R}_{\hat{\mathbf{x}}}(\phi) \,
    \mathbf{e}_r \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi}) \,
    \mathrm{d}\phi
    \nonumber
    \\
    %
    & =
    %
    \left(
    \mathbf{e}_\phi^0
    \,\,\,
    \mathbf{e}_\phi^1
    \,\,\,
    \mathbf{e}_\phi^2
    \,\,\,
    \cdots
    \,\,\,
    \mathbf{e}_\phi^{l_{\mathrm{max}}}
    \right)^\top
    \quad,
\end{proof}
%
where
%
\begin{proof}{test_ephi}
    \mathbf{e}_\phi^l
    & =
    \int
    \mathbf{R}^l_{\hat{\mathbf{x}}}(\phi) \,
    \mathbf{e}^l_r \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi}) \,
    \mathrm{d}\phi
    \nonumber \\
    %
    & =
    %
    {\mathbf{U}^l}^{-1}
    \mathbf{p}^l
    \quad,
\end{proof}
%
and we define
%
\begin{align}
    \label{eq:pl}
    \mathbf{p}^l
     & \equiv
    \int
    \mathbf{D}^l_{\hat{\mathbf{x}}}(\phi) \,
    \bar{\mathbf{e}}^l_r \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi}) \,
    \mathrm{d}\phi
    \\
    \bar{\mathbf{e}}^l_r
     & \equiv
    \mathbf{U}^l
    \mathbf{e}^l_r
    \quad.
\end{align}
%
The integral $\mathbf{p}^l$ defined above has a closed-form solution.
To show this, we write the terms of $\mathbf{p}^l$ as
%
\begin{align}
    p^l_m
     & =
    \int
    \sum\limits_{\mu=-l}^l
    {D^l_{\hat{\mathbf{x}}}}_{m,\mu}(\phi) \,
    {\bar{e}^l}{{}_r}_{\mu} \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi}) \,
    \mathrm{d}\phi
    %
    \nonumber \\[0.5em]
    %
     & =
    \dfrac{\Gamma(\alpha + \beta)}{\Gamma(\alpha)\Gamma(\beta)}
    \sum\limits_{\mu=-l}^l
    {\bar{e}^l}{{}_r}_{\mu}
    \mathrm{e}^{\frac{\imag \pi}{2}(m - \mu)}
    \sum\limits_{i=0}^{2l} c_{m,\mu,i}^{l}
    \,
    q^l_i(\pmb{\theta}_{\phi})
    \quad,
\end{align}
%
where
%
\begin{proof}{test_qli}
    q^l_i(\pmb{\theta}_{\phi})
    & \equiv
    \frac{1}{2}
    \int_{-\frac{\pi}{2}}^{\frac{\pi}{2}}
    %
    \mathrm{sgn}(\sin\phi)^{i}
    \big| \sin\phi \big|
    (\cos\phi)^{\alpha - 1}
    (1 - \cos\phi)^{l + \beta - \frac{i}{2} - 1}
    (1 + \cos\phi)^\frac{i}{2}
    %
    \,
    \mathrm{d}\phi
    \nonumber \\[0.5em]
    %
    & =
    %
    \begin{cases}
        \displaystyle\int_{0}^{1}
        %
        x^{\alpha - 1}
        (1 - x)^{l + \beta - \frac{i}{2} - 1 }
        (1 + x)^\frac{i}{2}
        %
        \,
        \mathrm{d}x
        %
         & i \,\, \mathrm{even}
        %
        \\
        %
        0
        %
         & i \,\, \mathrm{odd} \quad,
    \end{cases}
\end{proof}
%
and in the last line we made use of the transformation $x = \cos\phi$.
%
The integral in the expression above has a closed-form solution in terms
of the hypergeometric function $_2F_1$:
%
\begin{proof}{test_qli}
    %
    \label{eq:qli}
    q^l_i(\pmb{\theta}_{\phi})
    & =
    \resizebox{.75\hsize}{!}{$
            \begin{cases}
                \dfrac{\Gamma(\alpha)\Gamma(l + \beta - \frac{i}{2})}{\Gamma(l + \alpha + \beta - \frac{i}{2})}
                \,
                _2F_1\Big(
                -\frac{i}{2},
                \alpha;
                l + \alpha + \beta - \frac{i}{2};
                -1
                \Big)
                %
                 & i \,\, \mathrm{even}
                %
                \\
                %
                0
                %
                 & i \,\, \mathrm{odd} \quad.
            \end{cases}
        $}
\end{proof}
%
In order to compute the integral $\mathbf{e}_\phi$
(Equation~\ref{eq:e2}) we must evaluate Equation~(\ref{eq:qli})
for all $0 \leq l \leq l_{\mathrm{max}}$, $0 \leq i \leq 2l$,
which can be done efficiently via upward recursion relations for both
the gamma function and the hypergeometric function.

\subsubsection{Second moment}
%
Similarly as before, let us write the second moment integral as
%
\begin{proof}{}
    \mathbf{E}_\phi
    & \equiv
    \int
    \mathbf{R}_{\hat{\mathbf{x}}}(\phi) \,
    \mathbf{E}_r \,
    \mathbf{E}_r^\top \,
    \mathbf{R}_{\hat{\mathbf{x}}}^\top(\phi) \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi}) \,
    \mathrm{d}\phi
    \nonumber
    \\
    %
    & =
    %
    \setstackgap{L}{1.25\baselineskip}
    \fixTABwidth{T}
    \parenMatrixstack{
    \mathbf{E}_\phi^{0,0} & \mathbf{E}_\phi^{0,1} & \mathbf{E}_\phi^{0,2} & \cdots & \mathbf{E}_\phi^{0,l_{\mathrm{max}}} \\
    \mathbf{E}_\phi^{1,0} & \mathbf{E}_\phi^{1,1} & \mathbf{E}_\phi^{1,2} & \cdots & \mathbf{E}_\phi^{1,l_{\mathrm{max}}} \\
    \mathbf{E}_\phi^{2,0} & \mathbf{E}_\phi^{2,1} & \mathbf{E}_\phi^{2,2} & \cdots & \mathbf{E}_\phi^{2,l_{\mathrm{max}}} \\
    \vdots & \vdots & \vdots & \ddots & \vdots \\
    \mathbf{E}_\phi^{l_{\mathrm{max}},0} & \mathbf{E}_\phi^{l_{\mathrm{max}},1} & \mathbf{E}_\phi^{l_{\mathrm{max}},2} & \cdots & \mathbf{E}_\phi^{l_{\mathrm{max}},l_{\mathrm{max}}}
    }
    \quad,
\end{proof}
%
where
%
\begin{proof}{}
    \mathbf{E}_\phi^{l,l'}
    & =
    \int
    \mathbf{R}^l_{\hat{\mathbf{x}}}(\phi) \,
    \mathbf{E}^l_r \,
    {\mathbf{E}^l_r}^\top \,
    {\mathbf{R}^{l'}_{\hat{\mathbf{x}}}}^\top(\phi) \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi}) \,
    \mathrm{d}\phi
    \nonumber \\
    %
    & =
    %
    {\mathbf{U}^l}^{-1}
    \mathbf{P}^l
    {{\mathbf{U}^l}^{-1}}^\top
\end{proof}
%
and we define
%
\begin{align}
    \label{eq:Pl}
    \mathbf{P}^l
     & \equiv
    \int
    \mathbf{D}^l_{\hat{\mathbf{x}}}(\phi) \,
    \bar{\mathbf{E}}^l_r \,
    {\mathbf{D}^l_{\hat{\mathbf{x}}}}^\top(\phi) \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi}) \,
    \mathrm{d}\phi
    \\
    \bar{\mathbf{E}}^l_r
     & \equiv
    \mathbf{U}^l
    \mathbf{E}^l_r
    {\mathbf{E}^l_r}^\top
    {\mathbf{U}^l}^\top
    \quad.
\end{align}
%
As before, we may express the solution to the integral $\mathbf{P}^l$ in
closed form. Let us write the terms of $\mathbf{P}^l$ as
%
\begin{align}
    P^l_{m,m'}
     & =
    \int
    \sum\limits_{\mu=-l}^l
    \sum\limits_{\nu=-l}^l
    {D^l_{\hat{\mathbf{x}}}}_{m,\mu}(\phi) \,
    {\bar{E}^l}{{}_r}_{\mu,\nu} \,
    {D^l_{\hat{\mathbf{x}}}}_{\nu,m'}(\phi) \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi}) \,
    \mathrm{d}\phi
    %
    \nonumber \\[0.5em]
    %
     & =
    \resizebox{.75\hsize}{!}{$
        \dfrac{\Gamma(\alpha + \beta)}{\Gamma(\alpha)\Gamma(\beta)}
        \sum\limits_{\mu=-l}^l
        \sum\limits_{\nu=-l}^l
        {\bar{E}^l}{{}_r}_{\mu,\nu}
        \mathrm{e}^{\frac{\imag \pi}{2}(m - \mu + \nu - m')}
        \sum\limits_{i=0}^{2l}
        \sum\limits_{j=0}^{2l}
        c_{m,\mu,i}^{l}
        c_{\nu,m',j}^{l}
        \,
        Q^l_{i,j}(\pmb{\theta}_{\phi})
    $}
    \quad,
\end{align}
%
where, similarly to before,
%
\begin{proof}{}
    Q^l_{i,j}(\pmb{\theta}_{\phi})
    & \equiv
    \frac{1}{2}
    \int_{-\frac{\pi}{2}}^{\frac{\pi}{2}}
    %
    \mathrm{sgn}(\sin\phi)^{i+j}
    \big| \sin\phi \big|
    (\cos\phi)^{\alpha - 1}
    (1 - \cos\phi)^{2l + \beta - \frac{i+j}{2} - 1}
    (1 + \cos\phi)^\frac{i+j}{2}
    %
    \,
    \mathrm{d}\phi
    \nonumber \\[0.5em]
    %
    & =
    %
    \begin{cases}
        \displaystyle\int_{0}^{1}
        %
        x^{\alpha - 1}
        (1 - x)^{2l + \beta - \frac{i+j}{2} - 1 }
        (1 + x)^\frac{i+j}{2}
        %
        \,
        \mathrm{d}x
        %
         & i+j \,\, \mathrm{even}
        %
        \\
        %
        0
        %
         & i+j \,\, \mathrm{odd} \quad.
    \end{cases}
\end{proof}
%
We may again express this integral in closed form:
%
\begin{proof}{}
    %
    \label{eq:Qlij}
    Q^l_{i,j}(\pmb{\theta}_{\phi})
    & =
    \resizebox{.75\hsize}{!}{$
            \begin{cases}
                \dfrac{\Gamma(\alpha)\Gamma(2l + \beta - \frac{i+j}{2})}{\Gamma(2l + \alpha + \beta - \frac{i+j}{2})}
                \,
                _2F_1\Big(
                -\frac{i+j}{2},
                \alpha;
                2l + \alpha + \beta - \frac{i+j}{2};
                -1
                \Big)
                %
                 & i+j \,\, \mathrm{even}
                %
                \\
                %
                0
                %
                 & i+j \,\, \mathrm{odd} \quad.
            \end{cases}
        $}
\end{proof}
%
As before, this integral may be evaluated recursively to efficiently compute all
of the terms in $\mathbf{E}_\phi$.

\bibliography{bib}
\end{document}