% !TeX root = ./ms.tex
\documentclass[modern]{aastex62}

% Load the corTeX style definitions
\input{cortex}

% Load custom style
\input{style}

% Bibliography
\bibliographystyle{aasjournal}

\usepackage{etoolbox}
\makeatletter % we need to patch \env@cases that has @ in its name
\patchcmd{\env@cases}{\quad}{\qquad\qquad}{}{}
\makeatother

\usepackage{enumitem}

% Begin!
\begin{document}

% Title
\title{%
    \textbf{
        Interpretable Gaussian Processes for Stellar Light Curves
    }
}

% Author list
\author[0000-0002-0296-3826]{Rodrigo Luger}\altaffiliation{Flatiron Fellow}
\email{rluger@flatironinstitute.org}
\affil{Center~for~Computational~Astrophysics, Flatiron~Institute, New~York, NY}
\affil{Virtual~Planetary~Laboratory, University~of~Washington, Seattle, WA}
%

\keywords{methods: analytic}

% \begin{abstract}
%     Abstract here.
%     %
%     \href{https://github.com/rodluger/starry_process}{\color{linkcolor}\faGithub}
% \end{abstract}

\section{Introduction}
\label{sec:intro}
\xxx{Talk about starry, gps, etc.}

\section{Spherical Harmonics}
\label{sec:ylm}
%
\xxx{Introduce the spherical harmonics.}

The real spherical harmonics are indexed by their degree $l \in [0, \infty]$
and order $m \in [-l, l]$. It is convenient to collect the spherical harmonic coefficients of
a given expansion into a vector $\mathbf{y}$ indexed by a single
integer $n$, where
%
\begin{align}
    \label{eq:n}
    n = l^2 + l + m
\end{align}
%
and, conversely,
%
\begin{align}
    \label{eq:lm}
    \begin{split}
        l & = \floor{\sqrt{n}}
        \\
        m & = n - l^2 - l
        \quad.
    \end{split}
\end{align}

\section{Gaussian Process}
\label{sec:gp}
%

% The vector $\pmb{\theta}$ includes physical properties of the star such
% as its inclination $i$ and rotational period $P$ as well as parameters
% describing the shape of the probability density function (PDF) governing
% the distribution of features on the surface.

Let
$\mathbf{f} = \left( f_0 \, f_1 \, \cdots \,  f_K \right)^\top$
denote a vector of $K$ flux measurements at times
$\left( t_0 \,  t_1 \,  \cdots \, t_K \right)^\top$.
Conditioned on certain physical properties of the star, $\pmb{\theta}$,
we wish to compute the mean $\pmb{\mu}(\pmb{\theta})$ and
covariance $\pmb{\Sigma}(\pmb{\theta})$
of $\mathbf{f}$, which together fully specify our GP in flux.
%
As with any random variable, the mean and covariance may be computed from
the expectation value of $\mathbf{f}$ and
$\mathbf{f}\,\mathbf{f}^\top$, respectively:
%
\begin{align}
    \label{eq:mean}
    \pmb{\mu}(\pmb{\theta})
     & = \mathrm{E} \Big[ \mathbf{f} \, \Big| \, \pmb{\theta} \Big]
    \\
    \label{eq:cov}
    \pmb{\Sigma}(\pmb{\theta})
     & = \mathrm{E} \Big[ \mathbf{f} \, \mathbf{f}^\top \, \Big| \, \pmb{\theta} \Big] - \pmb{\mu}(\pmb{\theta}) \pmb{\mu}^\top(\pmb{\theta})
    \quad.
\end{align}
%
In \citet{Luger2019} we showed that $\mathbf{f}$ may be computed from a
linear operation on the vector of spherical harmonic coefficients
describing the surface, $\mathbf{y}$:
%
\begin{align}
    \label{eq:fAy}
    \mathbf{f} = \mathbf{A} \, \mathbf{y}
    \quad,
\end{align}
%
where $\mathbf{A}$ is the \starry design matrix, which is implicitly
a function of $\pmb{\theta}$ (as it depends on the stellar inclination
and rotation period, for example).
%
Given Equation~(\ref{eq:fAy}),
we may write the mean and covariance of our flux GP as
%
\begin{align}
    \pmb{\mu}(\pmb{\theta})
     & = \mathbf{A}(\pmb{\theta}) \, \pmb{\mu}_{\mathbf{y}}(\pmb{\theta})
    \\
    \pmb{\Sigma}(\pmb{\theta})
     & = \mathbf{A}(\pmb{\theta}) \, \pmb{\Sigma}_{\mathbf{y}} \, \mathbf{A}^\top(\pmb{\theta})
    \quad,
\end{align}
%
where
%
\begin{align}
    \label{eq:mean_y}
    \pmb{\mu}_{\mathbf{y}}(\pmb{\theta})
     & = \mathrm{E} \Big[ \mathbf{y} \, \Big| \, \pmb{\theta} \Big]
    \\
    \label{eq:cov_y}
    \pmb{\Sigma}_{\mathbf{y}}(\pmb{\theta})
     & = \mathrm{E} \Big[ \mathbf{y} \, \mathbf{y}^\top \, \Big| \, \pmb{\theta} \Big] - \pmb{\mu}_{\mathbf{y}}(\pmb{\theta}) \pmb{\mu}_{\mathbf{y}}^\top(\pmb{\theta})
\end{align}
%
are the mean and covariance of the GP in the spherical harmonics basis.
The bulk of the math in this paper is devoted to computing
the expectations in the expressions above, which
are given by the integrals
%
\begin{align}
    \label{eq:exp_y}
    \mathrm{E} \Big[ \mathbf{y} \, \Big| \, \pmb{\theta} \Big]
     & =
    \int \mathbf{y}(\mathbf{x} ) \, p(\mathbf{x} \, \big| \, \pmb{\theta})\mathrm{d}\mathbf{x}
    \\
    \label{eq:exp_yy}
    \mathrm{E} \Big[ \mathbf{y} \, \mathbf{y}^\top \, \Big| \, \pmb{\theta} \Big]
     & =
    \int \mathbf{y}(\mathbf{x} ) \mathbf{y}^\top(\mathbf{x} ) \, p(\mathbf{x} \, \big| \, \pmb{\theta})\mathrm{d}\mathbf{x}
    \quad,
\end{align}
%
where $\mathbf{x}$ is a random vector-valued variable corresponding to a particular
distribution of features on the surface  (i.e., the size and location of star spots)
and $p(\mathbf{x} \, \big| \, \pmb{\theta})$ is its probability density
function (PDF).

In the sections that follow we will show that for suitable choices of $\mathbf{y}(\mathbf{x})$
and $p(\mathbf{x} \, \big| \, \pmb{\theta})$, the integrals in the expressions
above have closed form solutions that may be evaluated quickly.
%
As we are specifically interested in modeling the effect of star spots
on stellar light curves, we let
%
\begin{align}
    \mathbf{x} = \left( c \,\, \lambda \,\, \phi \,\, r \right)^\top
\end{align}
%
and
%
\begin{align}
    \label{eq:RRs}
    \mathbf{y}(\mathbf{x}) =
    c
    \,
    \mathbf{R}_{\hat{\mathbf{y}}}(\lambda)
    \,
    \mathbf{R}_{\hat{\mathbf{x}}}(\phi)
    \,
    \mathbf{s}(r)
    \quad,
\end{align}
%
where $c$ is the contrast of a spot,
$\lambda$ is its longitude, $\phi$ is its latitude,
and $r$ is its radius.
The vector function $\mathbf{s}(r)$
returns the spherical harmonic expansion of a negative unit brightness
circular spot at $\lambda = \phi = 0$,
$\mathbf{R}_{\hat{\mathbf{x}}}(\phi)$ is the Wigner matrix that rotates the
expansion about $\hat{\mathbf{x}}$ such that the spot is centered at a
latitude $\phi$, and $\mathbf{R}_{\hat{\mathbf{y}}}(\lambda)$ is the Wigner
matrix that then rotates the
expansion about $\hat{\mathbf{y}}$ such that the spot is centered at a
longitude $\lambda$; these three functions are detailed in the sections below.
%
Equation~(\ref{eq:RRs}) thus provides a way of converting a random variable
$\mathbf{x}$ describing the size, brightness, and position of a spot to the
corresponding representation in terms of spherical harmonics.
%
Note, importantly, that we are not interested in any specific value of
$\mathbf{y}$; rather, we would like to know its expectation value under
the probability distribution governing the different spot properties $\mathbf{x}$,
i.e., $p(\mathbf{x} \, \big| \, \pmb{\theta})$.
%
For simplicity, we assume that $p(\mathbf{x} \, \big| \, \pmb{\theta})$
is separable in each of the four spot properties:
%
\begin{align}
    p(\mathbf{x} \, \big| \, \pmb{\theta})
    =
    p(c \, \big| \, \pmb{\theta}_{c}) \,
    p(\lambda \, \big| \, \pmb{\theta}_{\lambda}) \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi})\,
    p(r \, \big| \, \pmb{\theta}_{r})
    \quad,
\end{align}
%
where
%
\begin{align}
    \pmb{\theta} = \left(
    \pmb{\theta}_{c} \, \,
    \pmb{\theta}_{\lambda} \, \,
    \pmb{\theta}_{\phi} \, \,
    \pmb{\theta}_{r} \right)^\top
    \quad.
\end{align}
%
This allows us to rewrite the expectation integrals (\ref{eq:exp_y})
and (\ref{eq:exp_yy}) as
%
\begin{align}
    \label{eq:exp_y_sep}
    \mathrm{E} \Big[ \mathbf{y} \, \Big| \, \pmb{\theta} \Big]
     & =
    \mathbf{e_4}(\pmb{\theta})
    \\[1em]
    \label{eq:exp_yy_sep}
    \mathrm{E} \Big[ \mathbf{y} \, \mathbf{y}^\top \, \Big| \, \pmb{\theta} \Big]
     & =
    \mathbf{E_4}(\pmb{\theta})
\end{align}
%
where we define the first moment integrals
%
\begin{align}
    \label{eq:e1}
    \mathbf{e_1}(\pmb{\theta}_r)
     & \equiv
    \int
    \mathbf{s}(r) \,
    p(r \, \big| \, \pmb{\theta}_{r}) \,
    \mathrm{d}r
    %
    \\[1em]
    %
    \label{eq:e2}
    \mathbf{e_2}(\pmb{\theta}_\phi, \mathbf{e_1})
     & \equiv
    \int
    \mathbf{R}_{\hat{\mathbf{x}}}(\phi) \,
    \mathbf{e_1} \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi}) \,
    \mathrm{d}\phi
    %
    \\[1em]
    %
    \label{eq:e3}
    \mathbf{e_3}(\pmb{\theta}_\lambda, \mathbf{e_2})
     & \equiv
    \int
    \mathbf{R}_{\hat{\mathbf{y}}}(\lambda) \,
    \mathbf{e_2} \,
    p(\lambda \, \big| \, \pmb{\theta}_{\lambda}) \,
    \mathrm{d}\lambda
    \\[1em]
    \label{eq:e4}
    \mathbf{e_4}(\pmb{\theta}_c, \mathbf{e_3})
     & \equiv
    \int
    c \,
    \mathbf{e_3} \,
    p(c \, \big| \, \pmb{\theta}_{c}) \,
    \mathrm{d}c
    %
\end{align}
%
and the second moment integrals
%
\begin{align}
    \label{eq:E1}
    \mathbf{E_1}(\pmb{\theta}_r)
     & \equiv
    \int
    \mathbf{s}(r) \, \mathbf{s}^\top(r) \,
    p(r \, \big| \, \pmb{\theta}_{r}) \,
    \mathrm{d}r
    %
    \\[1em]
    %
    \label{eq:E2}
    \mathbf{E_2}(\pmb{\theta}_\phi, \mathbf{E_1})
     & \equiv
    \int
    \mathbf{R}_{\hat{\mathbf{x}}}(\phi) \,
    \mathbf{E_1} \,
    \mathbf{E_1}^\top \,
    \mathbf{R}_{\hat{\mathbf{x}}}^\top(\phi) \,
    p(\phi \, \big| \, \pmb{\theta}_{\phi})
    \mathrm{d}\phi
    %
    \\[1em]
    %
    \label{eq:E3}
    \mathbf{E_3}(\pmb{\theta}_\lambda, \mathbf{E_2})
     & \equiv
    \int
    \mathbf{R}_{\hat{\mathbf{y}}}(\lambda) \,
    \mathbf{E_2} \,
    \mathbf{E_2}^\top \,
    \mathbf{R}_{\hat{\mathbf{y}}}^\top(\lambda) \,
    p(\lambda \, \big| \, \pmb{\theta}_{\lambda})
    \mathrm{d}\phi
    \\[1em]
    %
    \label{eq:E4}
    \mathbf{E_4}(\pmb{\theta}_c, \mathbf{E_3})
     & \equiv
    \int
    c^2 \,
    \mathbf{E_3} \,
    \mathbf{E_3}^\top \,
    p(c \, \big| \, \pmb{\theta}_c)
    \mathrm{d}c
    %
    \quad.
\end{align}
%
We devote the next four sections to the computation of these eight
integrals.




\bibliography{bib}
\end{document}